<h1>Search Music</h1>
<form id="search-form">
  <input type="text" id="search-query" placeholder="Search for a title, artist, or album..." required />
  <button type="submit">Search</button>
</form>

<div id="search-results"></div>

<script>
  const form = document.getElementById('search-form');
  const queryInput = document.getElementById('search-query');
  const resultsDiv = document.getElementById('search-results');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const query = queryInput.value;

    try {
      const response = await fetch(`/api/search?query=${encodeURIComponent(query)}`);
      const music = await response.json();
      resultsDiv.innerHTML = music.map(item => `
        <div class="music-item">
          <img src="${item.cover}" alt="${item.title}" />
          <p><strong>${item.title}</strong> by ${item.artist}</p>
          <p>Album: ${item.album}</p>
          <a href="${item.link}" target="_blank">Listen on Deezer</a>
          <label for="rating-${item.id}">Rate:</label>
          <input id="rating-${item.id}" type="number" min="1" max="5" value="5">
          <button onclick="saveMusic('${item.title}', '${item.artist}', '${item.album}', '${item.cover}', document.getElementById('rating-${item.id}').value)">Save</button>
        </div>
      `).join('');
    } catch (err) {
      console.error('Error fetching music:', err);
      resultsDiv.innerHTML = '<p>Failed to fetch music. Please try again later.</p>';
    }
  });

  async function saveMusic(title, artist, album, cover, rating) {
    try {
      const response = await fetch('/music/add', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, artist, album, album_cover_url: cover, rating }),
      });

      if (response.ok) {
        alert('Music saved successfully!');
      } else {
        alert('Failed to save the music.');
      }
    } catch (err) {
      console.error('Error saving music:', err);
      alert('An error occurred.');
    }
  }
</script>
